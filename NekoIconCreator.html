<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>猫咪头像编辑器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 md:p-8">
        <div class="flex flex-col items-center">
            
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">猫咪头像编辑器</h2>
            
            <div id="mainPreview" class="w-64 h-64 md:w-80 md:h-80 bg-gray-200 dark:bg-gray-700 rounded-2xl flex items-center justify-center p-4 transition-colors duration-300">
                <svg id="logoSvg" width="100%" height="100%" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path id="logoPath" d="M 15 85 L 35 30 L 50 60 L 65 30 L 85 85 M 40 70 L 50 80 L 60 70" 
                          stroke="#1f2937" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                </svg>
            </div>

            <div class="w-full mt-6 space-y-4">
                <div>
                    <label for="lineColor" class="block text-sm font-medium text-gray-700 dark:text-gray-300">线条颜色</label>
                    <input type="color" id="lineColor" value="#1f2937" class="mt-1 w-full h-10 p-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md cursor-pointer">
                </div>
                <div>
                    <label for="bgColor" class="block text-sm font-medium text-gray-700 dark:text-gray-300">背景颜色</label>
                    <input type="color" id="bgColor" value="#e5e7eb" class="mt-1 w-full h-10 p-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md cursor-pointer">
                </div>
                <div>
                    <label for="strokeWidth" class="block text-sm font-medium text-gray-700 dark:text-gray-300">线条粗细: <span id="strokeWidthValue">8</span></label>
                    <input type="range" id="strokeWidth" min="2" max="20" value="8" class="mt-1 w-full cursor-pointer">
                </div>
                <div>
                    <label for="overallScale" class="block text-sm font-medium text-gray-700 dark:text-gray-300">整体缩放: <span id="overallScaleValue">100</span>%</label>
                    <input type="range" id="overallScale" min="50" max="150" value="100" class="mt-1 w-full cursor-pointer">
                </div>
                <div>
                    <label for="bodyAngle" class="block text-sm font-medium text-gray-700 dark:text-gray-300">猫身角度: <span id="bodyAngleValue">0</span></label>
                    <input type="range" id="bodyAngle" min="-10" max="15" value="0" class="mt-1 w-full cursor-pointer">
                </div>
                 <div>
                    <label for="bodyLength" class="block text-sm font-medium text-gray-700 dark:text-gray-300">猫身长度: <span id="bodyLengthValue">0</span></label>
                    <input type="range" id="bodyLength" min="-15" max="15" value="0" class="mt-1 w-full cursor-pointer">
                </div>
                <div>
                    <label for="earDistance" class="block text-sm font-medium text-gray-700 dark:text-gray-300">猫耳距离: <span id="earDistanceValue">0</span></label>
                    <input type="range" id="earDistance" min="-15" max="10" value="0" class="mt-1 w-full cursor-pointer">
                </div>
                <div>
                    <label for="smileDistance" class="block text-sm font-medium text-gray-700 dark:text-gray-300">笑容距离: <span id="smileDistanceValue">0</span></label>
                    <input type="range" id="smileDistance" min="-10" max="15" value="0" class="mt-1 w-full cursor-pointer">
                </div>
            </div>

            <div class="w-full mt-8 space-y-3 border-t border-gray-200 dark:border-gray-700 pt-6">
                <button id="downloadPng" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors">下载 PNG (256x256)</button>
                <button id="downloadSvg" class="w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors">下载 SVG (矢量)</button>
            </div>
        </div>
    </div>

    <script>
        const mainPreview = document.getElementById('mainPreview');
        const logoSvg = document.getElementById('logoSvg');
        const logoPath = document.getElementById('logoPath');
        const lineColor = document.getElementById('lineColor');
        const bgColor = document.getElementById('bgColor');
        const strokeWidth = document.getElementById('strokeWidth');
        const strokeWidthValue = document.getElementById('strokeWidthValue');
        const overallScale = document.getElementById('overallScale');
        const overallScaleValue = document.getElementById('overallScaleValue');
        const bodyAngle = document.getElementById('bodyAngle');
        const bodyAngleValue = document.getElementById('bodyAngleValue');
        const bodyLength = document.getElementById('bodyLength');
        const bodyLengthValue = document.getElementById('bodyLengthValue');
        const earDistance = document.getElementById('earDistance');
        const earDistanceValue = document.getElementById('earDistanceValue');
        const smileDistance = document.getElementById('smileDistance');
        const smileDistanceValue = document.getElementById('smileDistanceValue');
        const downloadPng = document.getElementById('downloadPng');
        const downloadSvg = document.getElementById('downloadSvg');

        function updateLogo() {
            // 更新颜色和粗细
            logoPath.setAttribute('stroke', lineColor.value);
            mainPreview.style.backgroundColor = bgColor.value;
            logoPath.setAttribute('stroke-width', strokeWidth.value);
            strokeWidthValue.textContent = strokeWidth.value;

            // 更新路径
            const angle = parseInt(bodyAngle.value, 10);
            const length = parseInt(bodyLength.value, 10);
            const earDist = parseInt(earDistance.value, 10);
            const smileDist = parseInt(smileDistance.value, 10);
            
            const mPath = `M ${15 - angle} ${85 + length + earDist} L 35 ${30 + earDist} L 50 ${60 + earDist} L 65 ${30 + earDist} L ${85 + angle} ${85 + length + earDist}`;
            const vPath = `M 40 ${70 + smileDist} L 50 ${80 + smileDist} L 60 ${70 + smileDist}`;
            
            logoPath.setAttribute('d', `${mPath} ${vPath}`);
            bodyAngleValue.textContent = angle;
            bodyLengthValue.textContent = length;
            earDistanceValue.textContent = earDist;
            smileDistanceValue.textContent = smileDist;

            // 根据缩放值动态调整 viewBox
            const scale = parseInt(overallScale.value, 10) / 100;
            const size = 100 / scale;
            const offset = (100 - size) / 2;
            logoSvg.setAttribute('viewBox', `${offset} ${offset} ${size} ${size}`);
            overallScaleValue.textContent = overallScale.value;
        }

        lineColor.addEventListener('input', updateLogo);
        bgColor.addEventListener('input', updateLogo);
        strokeWidth.addEventListener('input', updateLogo);
        overallScale.addEventListener('input', updateLogo);
        bodyAngle.addEventListener('input', updateLogo);
        bodyLength.addEventListener('input', updateLogo);
        earDistance.addEventListener('input', updateLogo);
        smileDistance.addEventListener('input', updateLogo);

        downloadPng.addEventListener('click', () => {
            const tempCanvas = document.createElement('canvas');
            const size = 256;
            tempCanvas.width = size;
            tempCanvas.height = size;
            const tempCtx = tempCanvas.getContext('2d');

            const svgString = new XMLSerializer().serializeToString(logoSvg);
            const svgBlob = new Blob([svgString], {type: 'image/svg+xml;charset=utf-8'});
            const url = URL.createObjectURL(svgBlob);

            const img = new Image();
            img.onload = () => {
                tempCtx.fillStyle = bgColor.value;
                tempCtx.fillRect(0, 0, size, size);
                tempCtx.drawImage(img, 0, 0, size, size);
                URL.revokeObjectURL(url);

                const link = document.createElement('a');
                link.download = 'cat-avatar.png';
                link.href = tempCanvas.toDataURL('image/png');
                link.click();
            };
            img.src = url;
        });

        downloadSvg.addEventListener('click', () => {
            // ✨ 核心修正：让背景矩形(rect)的位置和大小与 viewBox 完全同步
            const viewBoxValue = logoSvg.getAttribute('viewBox');
            const [x, y, width, height] = viewBoxValue.split(' ');

            const fullSvgString = `
                <svg width="256" height="256" viewBox="${viewBoxValue}" xmlns="http://www.w3.org/2000/svg">
                    <rect x="${x}" y="${y}" width="${width}" height="${height}" fill="${bgColor.value}" />
                    <path d="${logoPath.getAttribute('d')}" 
                          stroke="${lineColor.value}" 
                          stroke-width="${strokeWidth.value}" 
                          stroke-linecap="round" 
                          stroke-linejoin="round" 
                          fill="none"/>
                </svg>`;
            
            const svgBlob = new Blob([fullSvgString], {type: 'image/svg+xml;charset=utf-8'});
            const url = URL.createObjectURL(svgBlob);
            
            const link = document.createElement('a');
            link.download = 'cat-avatar.svg';
            link.href = url;
            link.click();
            URL.revokeObjectURL(url);
        });
        
        // 初始化
        updateLogo();
    </script>
</body>
</html>
